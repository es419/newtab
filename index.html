function buildTable(dat,title){
  document.getElementById('sheetName').textContent=title;
  const tbl=document.getElementById('dataTable'); tbl.innerHTML='';
  dat.forEach(r=>{
    const tr=document.createElement('tr');
    r.forEach(c=>{
      const td=document.createElement('td'); td.textContent=c||'';
      td.onclick=()=>startEdit(td);
      tr.appendChild(td);
    }); tbl.appendChild(tr);
  });
  document.getElementById('editorOverlay').style.display='flex';
}

let editing=null;
function startEdit(td){
  if(editing) finishEdit();
  editing=td; td.classList.add('editing');
  const v=td.textContent; td.innerHTML=<input id='ed' value="${v}" style='width:100%;background:#475569;color:white;border:0;'>;
  document.getElementById('ed').focus();
}
function finishEdit(){ if(!editing)return; const inp=editing.querySelector('input'); if(inp){ editing.textContent=inp.value; editing.classList.remove('editing'); editing=null; }}

document.getElementById('grid').onclick=e=>{
  if(e.target.tagName!=='BUTTON')return;
  const i=e.target.dataset.i, act=e.target.dataset.act;
  if(act==='open') window.open(items[i].url,'_blank');
  if(act==='editHere'){ loadSheet(sheetIdFromUrl(items[i].url)); }
};

document.getElementById('closeEditor').onclick=()=>{
  finishEdit(); document.getElementById('editorOverlay').style.display='none';
};
</script></body>
</html>
